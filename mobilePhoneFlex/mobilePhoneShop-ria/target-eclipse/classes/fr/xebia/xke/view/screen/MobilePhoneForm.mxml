<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml"
                layout="vertical" width="488" height="384" creationComplete="getList()">

    <mx:Form width="100%" height="100%" defaultButton="{saveButton}">
        <mx:FormHeading label="MobilePhone List" width="100%"/>
        <mx:FormItem label="ID:" width="127">
            <mx:TextInput width="100%" id="idText"
                          text="{MobilePhone(mobilePhoneDatagrid.selectedItem).id}" editable="false" enabled="false"/>
        </mx:FormItem>
        <mx:FormItem label="Title:" width="345">
            <mx:TextInput width="100%" id="nameText"
                          text="{MobilePhone(mobilePhoneDatagrid.selectedItem).name}"/>
        </mx:FormItem>
        <mx:DataGrid id="mobilePhoneDatagrid" width="100%" height="100%" dataProvider="{mobilePhones}">
            <mx:columns>
                <mx:DataGridColumn headerText="ID" dataField="id" width="30"/>
                <mx:DataGridColumn headerText="Name" dataField="name"/>
            </mx:columns>
        </mx:DataGrid>
    </mx:Form>

    <mx:ControlBar horizontalAlign="center">
        <mx:Button label="New" click="setDefault()"/>
        <mx:Button label="Save" id="saveButton" click="save()"
                   textAlign="center"/>
        <mx:Button label="Delete" click="remove()"/>
    </mx:ControlBar>

    <mx:RemoteObject id="mobilePhoneService" showBusyCursor="true"
                     fault="onFault(event)" destination="mobilePhoneServiceSpring">
        <mx:method name="save" result="onResultSave(event)" fault="onFault(event)"/>
        <mx:method name="remove" result="onResultRemove(event)" fault="onFault(event)"/>
        <mx:method name="getList" result="onResultGetList(event)" fault="onFault(event)"/>
    </mx:RemoteObject>

    <mx:Script>
        <![CDATA[
        import mx.collections.ArrayCollection;
        import fr.xebia.xke.view.entity.MobilePhone;
        import mx.rpc.events.ResultEvent;
        import mx.rpc.events.FaultEvent;
        import mx.controls.Alert;

        [Bindable]
        private var mobilePhones:ArrayCollection;

        private var mobilePhone:MobilePhone;

        public function save():void
        {
            this.mobilePhone = new MobilePhone();
            this.mobilePhone.id = new Number(idText.text);
            this.mobilePhone.name = nameText.text;
            mobilePhoneService.save(mobilePhone);
        }

        public function onResultSave(event:ResultEvent):void
        {
            status = "MobilePhone was successfully saved with ID: " + MobilePhone(event.result).id;
            getList();
        }

        public function remove():void
        {
            if (mobilePhoneDatagrid.selectedItem != null) {
                mobilePhone = mobilePhoneDatagrid.selectedItem as MobilePhone;
                mobilePhoneService.remove(mobilePhone);
            } else {
                Alert.show("Select a mobilePhone to delete");
            }
        }

        public function onResultRemove(event:ResultEvent):void
        {
            status = "Deletion succeeded!";
            getList();
        }

        public function getList():void
        {
            mobilePhoneService.getList();
        }

        public function onResultGetList(event:ResultEvent):void
        {
            mobilePhones = event.result as ArrayCollection;
        }

        public function setDefault():void
        {
            idText.text = "";
            nameText.text = "";
        }

        public function onFault(event:FaultEvent):void
        {
            Alert.show(event.fault.message);
        }
        ]]>
    </mx:Script>
</mx:TitleWindow>

